<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>List of Links</title>
  <script>
    // Parse one line into {label, url}
    function parseLine(line) {
      line = line.trim();
      if (!line) return null;

      // ignore comments starting with #
      if (line.startsWith('#')) return null;

      // 1) If it contains a pipe '|' -> split at first pipe: "label | url"
      const pipeIdx = line.indexOf('|');
      if (pipeIdx !== -1) {
        const label = line.slice(0, pipeIdx).trim();
        const url  = line.slice(pipeIdx + 1).trim();
        return { label: label || url, url: url || label };
      }

      // 2) If it matches "number: url" (e.g. "1: https://...") -> take part after colon as url
      const numColonMatch = line.match(/^\s*\d+\s*:\s*(.+)$/);
      if (numColonMatch) {
        const url = numColonMatch[1].trim();
        // try to make a label like "Link N" using the number (optional)
        const numMatch = line.match(/^\s*(\d+)\s*:/);
        const label = (numMatch ? ("Link " + numMatch[1]) : url);
        return { label, url };
      }

      // 3) If it looks like "label - url" (dash) or "label : url" (rare), try splitting at first dash or colon after some text
      const dashIdx = line.indexOf(' - ');
      if (dashIdx !== -1) {
        const label = line.slice(0, dashIdx).trim();
        const url   = line.slice(dashIdx + 3).trim();
        return { label: label || url, url: url || label };
      }

      // 4) Otherwise treat whole thing as a URL (or label=url)
      return { label: line, url: line };
    }

    async function displayLinks() {
      try {
        const response = await fetch("https://raw.githubusercontent.com/tpr296/redirect/main/link.txt");
        const text = await response.text();

        const lines = text.split(/\r?\n/);
        const items = lines
          .map(l => parseLine(l))
          .filter(x => x && x.url);

        if (items.length === 0) {
          document.body.innerHTML = "<h2>No links found.</h2>";
          return;
        }

        // Build the list using DOM methods (safer than innerHTML)
        document.body.innerHTML = ""; // clear
        const h2 = document.createElement('h2');
        h2.textContent = "Links:";
        document.body.appendChild(h2);

        const ul = document.createElement('ul');

        items.forEach((it, index) => {
          const li = document.createElement('li');

          const prefix = document.createTextNode((index + 1) + ": ");
          li.appendChild(prefix);

          const a = document.createElement('a');
          a.textContent = it.label;
          a.setAttribute('href', it.url);
          a.setAttribute('target', '_blank');
          a.setAttribute('rel', 'noopener noreferrer');

          li.appendChild(a);
          ul.appendChild(li);
        });

        document.body.appendChild(ul);

      } catch (err) {
        document.body.innerHTML = "<h2>Error loading links.</h2>";
        console.error(err);
      }
    }

    window.onload = displayLinks;
  </script>
</head>
<body>
  <p>Loading links...</p>
</body>
</html>
